<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CPR Validator</title>

<link rel="icon" href="favicon.ico" type="image/x-icon">

<style>
:root {
  --bg: #020617;
  --border: #1e293b;
  --text: #e5e7eb;
  --muted: #64748b;
  --accent: #6366f1;
  --accent-glow: rgba(99,102,241,.4);
  --good: #22c55e;
  --bad: #ef4444;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  display: grid;
  place-items: center;
  background:
    radial-gradient(700px 300px at 50% -15%, #0f172a, transparent),
    var(--bg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: var(--text);
}

.card {
  width: 100%;
  max-width: 420px;
  padding: 28px;
  border-radius: 16px;
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
  border: 1px solid var(--border);
  box-shadow: 0 30px 80px rgba(0,0,0,.65);
}

h1 {
  margin: 0 0 18px;
  font-size: 18px;
  font-weight: 600;
  letter-spacing: .4px;
}

input {
  width: 100%;
  padding: 16px;
  font-size: 16px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #020617;
  color: var(--text);
  outline: none;
}

input::placeholder { color: var(--muted); }

input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 4px var(--accent-glow);
}

.result {
  margin-top: 16px;
  padding: 14px 16px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.02);
  min-height: 46px;
  display: flex;
  align-items: center;
}

.valid {
  color: var(--good);
  border-color: rgba(34,197,94,.4);
}

.invalid {
  color: var(--bad);
  border-color: rgba(239,68,68,.4);
}

.idle { color: var(--muted); }

.explainer {
  display: none;
  margin-top: 14px;
}

.explainer pre {
  margin: 0;
  background: #020617;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 14px;
  overflow: auto;
  color: var(--text);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: 12.5px;
  line-height: 1.45;
}

.linkrow {
  margin-top: 18px;
  font-size: 13px;
  color: var(--muted);
}
.linkrow a {
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
}
.linkrow a:hover { text-decoration: underline; }
</style>
</head>

<body>
<div class="card">
  <h1>CPR Validator</h1>

  <input
    id="input"
    type="text"
    placeholder="Enter CPR or CVR number"
    autocomplete="off"
  >

  <div id="result" class="result idle">Waiting for input…</div>

  <div id="explanation" class="explainer">
    <pre id="calc"></pre>
  </div>

  <div class="linkrow">
    Need a test number?
    <a href="generator.html">Generate a valid CPR →</a>
  </div>
</div>

<script>
const WEIGHTS = [4,3,2,7,6,5,4,3,2,1];
const input = document.getElementById("input");
const result = document.getElementById("result");
const explanation = document.getElementById("explanation");
const calc = document.getElementById("calc");

input.addEventListener("input", validate);

function validate() {
  const value = input.value.replace(/\D/g, "");

  // reset explainer
  explanation.style.display = "none";
  calc.textContent = "";

  if (!value) return idle("Waiting for input…");

  // 1) Length
  if (value.length !== 8 && value.length !== 10) {
    return fail("Wrong Length: CPR must be 10 digits, CVR must be 8 digits");
  }

  // CVR: length-only per spec
  if (value.length === 8) {
    return success("Valid CVR");
  }

  // 2) Format (CPR only)
  if (!/^[0-3][0-9][0-1][0-9][0-9]{6}$/.test(value)) {
    return fail(
      "Invalid Format: CPR must match pattern [0-3][0-9][0-1][0-9][0-9][0-9][0-9][0-9][0-9][0-9]"
    );
  }

  // 3) Date (DDMMYY)
  const dd = +value.slice(0,2);
  const mm = +value.slice(2,4);
  const yy = +value.slice(4,6);
  const year = yy <= 25 ? 2000 + yy : 1900 + yy;

  const date = new Date(year, mm - 1, dd);
  if (
    date.getFullYear() !== year ||
    date.getMonth() + 1 !== mm ||
    date.getDate() !== dd
  ) {
    return fail("Invalid Date: The date DDMMYY is not a valid calendar date");
  }

  // 4) Modulus 11 checksum + explanation
  const digits = [...value].map(ch => Number(ch));
  const products = digits.map((d, i) => d * WEIGHTS[i]);
  const sum = products.reduce((a, b) => a + b, 0);
  const remainder = sum % 11;

  if (remainder !== 0) {
    explanation.style.display = "block";

    // Build a readable breakdown (aligned columns)
    const header =
      "Checksum (modulus 11) breakdown\n" +
      "--------------------------------\n" +
      `CPR:     ${value}\n` +
      `Digits:  ${digits.join(" ")}\n` +
      `Weights: ${WEIGHTS.join(" ")}\n` +
      `Prod:    ${products.join(" ")}\n\n` +
      `Sum = ${sum}\n` +
      `Sum ÷ 11 = ${(sum / 11).toFixed(6)}…\n` +
      `Remainder = ${remainder}\n\n` +
      "❌ Failed: remainder must be 0 (sum must be evenly divisible by 11)\n";

    calc.textContent = header;

    return fail("Failed Checksum: The modulus 11 validation failed");
  }

  return success("Valid CPR");
}

function success(msg) {
  result.className = "result valid";
  result.textContent = msg;
}

function fail(msg) {
  result.className = "result invalid";
  result.textContent = msg;
}

function idle(msg) {
  result.className = "result idle";
  result.textContent = msg;
}
</script>
</body>
</html>
